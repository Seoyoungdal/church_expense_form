<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì˜ìˆ˜ì¦ ë©´ì œ ì‹ ì²­ì„œ</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f8f9fa;
        }
        .form-container {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 15px;
        }
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 22px;
            font-weight: bold;
        }
        .form-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }
        .form-row.full-width {
            flex-direction: column;
            align-items: stretch;
        }
        .label {
            font-weight: bold;
            min-width: 100px;
            color: #34495e;
            margin-right: 10px;
        }
        .input-field {
            flex: 1;
            border: none;
            border-bottom: 1px solid #bdc3c7;
            padding: 8px 5px;
            font-size: 14px;
            background-color: transparent;
        }
        .input-field:focus {
            outline: none;
            border-bottom: 2px solid #3498db;
        }
        .amount-input {
            flex: 1;
            border: none;
            border-bottom: 1px solid #bdc3c7;
            padding: 8px 5px;
            font-size: 14px;
            background-color: transparent;
            cursor: pointer;
            text-align: right;
        }
        .amount-input:focus {
            outline: none;
            border-bottom: 2px solid #3498db;
        }
        .large-input {
            min-height: 60px;
            border: 1px solid #bdc3c7;
            padding: 10px;
            resize: vertical;
            border-radius: 4px;
        }
        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .signature-section {
            margin-top: 30px;
            display: flex;
            justify-content: space-around;
        }
        .signature-box {
            text-align: center;
            width: 180px;
        }
        .signature-pad {
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            height: 120px;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .signature-pad:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
        }
        .signature-placeholder {
            color: #bdc3c7;
            font-size: 12px;
            pointer-events: none;
        }
        .signature-pad canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .clear-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 10px;
            cursor: pointer;
            margin-top: 5px;
        }
        .save-options {
            text-align: center;
            margin: 20px 0;
        }
        .save-options button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
        }
        .save-options button:hover {
            background: #2980b9;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
            text-align: center;
        }
        .signature-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        .signature-modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 600px;
            max-width: 90%;
            text-align: center;
            display: flex;
            flex-direction: column;
        }
        .signature-modal h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
        }
        .large-signature-pad {
            border: 2px solid #3498db;
            border-radius: 8px;
            background-color: #fff;
            cursor: crosshair;
            position: relative;
            margin: 20px auto;
            width: 540px;
            height: 360px;
        }
        .large-signature-pad canvas {
            width: 100%;
            height: 100%;
            border-radius: 6px;
        }
        .large-signature-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #bdc3c7;
            font-size: 18px;
            pointer-events: none;
        }
        .signature-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .signature-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .signature-btn.save {
            background: #27ae60;
            color: white;
        }
        .signature-btn.clear {
            background: #e74c3c;
            color: white;
        }
        .signature-btn.cancel {
            background: #95a5a6;
            color: white;
        }
        .modal input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .modal button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .modal .confirm-btn {
            background: #3498db;
            color: white;
        }
        .modal .cancel-btn {
            background: #95a5a6;
            color: white;
        }
        @media print {
            body {
                background-color: white;
                margin: 0;
                padding: 10px;
            }
            .form-container {
                box-shadow: none;
                padding: 20px;
            }
            .save-options, .clear-btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="form-container" id="formContainer">
        <div class="header">
            <h1>ì˜ìˆ˜ì¦ ë©´ì œ ì‹ ì²­ì„œ</h1>
        </div>

        <div class="form-row">
            <span class="label">ì‹ ì²­ì¼:</span>
            <input type="date" class="input-field" id="applicationDate">
        </div>

        <div class="section">
            <div class="form-row">
                <span class="label">ì§€ì¶œì¼ì:</span>
                <input type="date" class="input-field" id="expenseDate">
            </div>

            <div class="form-row">
                <span class="label">ì§€ì¶œê¸ˆì•¡:</span>
                <input type="text" class="amount-input" id="amountInput" placeholder="ê¸ˆì•¡ ì…ë ¥" readonly>
                <span style="margin-left: 10px;">ì›</span>
            </div>

            <div class="form-row">
                <span class="label">ì§€ì¶œë‚´ìš©:</span>
                <input type="text" class="input-field" id="expenseContent" placeholder="ì˜ˆ: ì‚¬ë¬´ìš©í’ˆ êµ¬ì…, êµí†µë¹„ ë“±">
            </div>

            <div class="form-row full-width" style="margin-top: 15px;">
                <span class="label" style="margin-bottom: 8px;">ìƒì„¸ì‚¬ìœ :</span>
                <textarea class="input-field large-input" id="detailReason" placeholder="ì§€ì¶œì˜ êµ¬ì²´ì ì¸ ì‚¬ìœ ë¥¼ ê¸°ì¬í•´ ì£¼ì„¸ìš”."></textarea>
            </div>
        </div>

        <div class="section">
            <div style="font-weight: bold; margin-bottom: 10px; color: #34495e;">ì˜ìˆ˜ì¦ ë¯¸ì²¨ë¶€ ì‚¬ìœ </div>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="reason1">
                    <label for="reason1">ì˜ìˆ˜ì¦ ë¶„ì‹¤</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="reason2">
                    <label for="reason2">ì˜ìˆ˜ì¦ ë¯¸ë°œí–‰</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="reason3">
                    <label for="reason3">ê²½ì¡°ì‚¬ë¹„</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="reason4">
                    <label for="reason4">êµí†µë¹„</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="reason5">
                    <label for="reason5">ê¸°íƒ€</label>
                </div>
            </div>
        </div>

        <div class="signature-section">
            <div class="signature-box">
                <div class="signature-pad" id="applicantSignature">
                    <canvas id="applicantCanvas" style="display: none;"></canvas>
                    <div class="signature-placeholder" id="applicantPlaceholder">ì„œëª…í•˜ë ¤ë©´ í´ë¦­</div>
                </div>
                <button class="clear-btn" id="clearApplicant">ì§€ìš°ê¸°</button><br>
                <strong>ì‹ ì²­ì</strong>
            </div>
            
            <div class="signature-box">
                <div class="signature-pad" id="managerSignature">
                    <canvas id="managerCanvas" style="display: none;"></canvas>
                    <div class="signature-placeholder" id="managerPlaceholder">ì„œëª…í•˜ë ¤ë©´ í´ë¦­</div>
                </div>
                <button class="clear-btn" id="clearManager">ì§€ìš°ê¸°</button><br>
                <strong>ë¶€ì„œì¥ ìŠ¹ì¸</strong>
            </div>
        </div>

        <div style="margin-top: 25px; padding: 10px; background-color: #f1f3f4; border-radius: 4px; font-size: 12px; color: #6c757d; text-align: center;">
            â€» ë³¸ ì‹ ì²­ì„œëŠ” ì‚¬ì‹¤ì— ê·¼ê±°í•˜ì—¬ ì‘ì„±í•˜ë©°, ê°€ëŠ¥í•œ ê´€ë ¨ ì¦ë¹™ìë£Œë¥¼ ì²¨ë¶€í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
        </div>

        <div class="save-options">
            <button id="saveJPG">JPGë¡œ ì €ì¥</button>
            <button id="savePDF">PDFë¡œ ì €ì¥</button>
            <button id="printBtn">ì¸ì‡„í•˜ê¸°</button>
        </div>

        <!-- ë²„ì „ ì •ë³´ -->
        <div style="position: fixed; bottom: 10px; right: 10px; font-size: 10px; color: #95a5a6; background: rgba(255,255,255,0.8); padding: 2px 6px; border-radius: 3px;">
            v3.6
        </div>
    </div>

    <!-- ì„œëª… íŒì—… ëª¨ë‹¬ -->
    <div id="signatureModal" class="signature-modal">
        <div class="signature-modal-content">
            <h3 id="signatureTitle">ì„œëª…í•´ ì£¼ì„¸ìš”</h3>
            <div class="large-signature-pad" id="largeSignaturePad">
                <canvas id="largeSignatureCanvas"></canvas>
                <div class="large-signature-placeholder" id="largeSignaturePlaceholder">ì—¬ê¸°ì— ì„œëª…í•´ ì£¼ì„¸ìš”</div>
            </div>
            <div class="signature-buttons">
                <button class="signature-btn save" id="saveSignature">ì €ì¥</button>
                <button class="signature-btn clear" id="clearLargeSignature">ì§€ìš°ê¸°</button>
                <button class="signature-btn cancel" id="cancelSignature">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ê¸ˆì•¡ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="amountModal" class="modal">
        <div class="modal-content">
            <h3>ê¸ˆì•¡ ì…ë ¥</h3>
            <input type="number" id="amountNumber" placeholder="ìˆ«ìë§Œ ì…ë ¥">
            <div>
                <button class="confirm-btn" id="confirmAmount">í™•ì¸</button>
                <button class="cancel-btn" id="cancelAmount">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let canvases = {};
        let contexts = {};
        let currentSignatureType = null;
        let isDrawing = false;

        // ì•± ì´ˆê¸°í™”
        function initApp() {
            setupCanvases();
            setupEvents();
            setToday();
        }

        // ìº”ë²„ìŠ¤ ì„¤ì •
        function setupCanvases() {
            // ì‘ì€ ìº”ë²„ìŠ¤ë“¤
            canvases.applicant = document.getElementById('applicantCanvas');
            canvases.manager = document.getElementById('managerCanvas');
            canvases.large = document.getElementById('largeSignatureCanvas');

            // ì»¨í…ìŠ¤íŠ¸ ìƒì„±
            contexts.applicant = canvases.applicant?.getContext('2d');
            contexts.manager = canvases.manager?.getContext('2d');
            contexts.large = canvases.large?.getContext('2d');

            // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì • (3:2 ë¹„ìœ¨ë¡œ í†µì¼)
            if (canvases.applicant && contexts.applicant) {
                canvases.applicant.width = 180;
                canvases.applicant.height = 120; // 3:2 ë¹„ìœ¨
            }
            if (canvases.manager && contexts.manager) {
                canvases.manager.width = 180;
                canvases.manager.height = 120; // 3:2 ë¹„ìœ¨
            }

            // í° ìº”ë²„ìŠ¤ ì„¤ì • (ë‚˜ì¤‘ì— ëª¨ë‹¬ ì—´ë¦´ ë•Œ)
            setupLargeCanvas();
        }

        // í° ìº”ë²„ìŠ¤ ì„¤ì •
        function setupLargeCanvas() {
            if (!canvases.large || !contexts.large) return;
            
            const pad = document.getElementById('largeSignaturePad');
            if (!pad) return;
            
            setTimeout(() => {
                const rect = pad.getBoundingClientRect();
                canvases.large.width = rect.width - 4;
                canvases.large.height = rect.height - 4;
                setupDrawing(canvases.large, contexts.large);
            }, 100);
        }

        // ê·¸ë¦¬ê¸° ì´ë²¤íŠ¸ ì„¤ì •
        function setupDrawing(canvas, ctx) {
            if (!canvas || !ctx) return;

            let drawing = false;

            function getPos(e) {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            }

            function startDraw(e) {
                e.preventDefault();
                e.stopPropagation();
                drawing = true;
                const pos = getPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                
                // placeholder ìˆ¨ê¸°ê¸°
                const placeholder = document.getElementById('largeSignaturePlaceholder');
                if (placeholder) placeholder.style.display = 'none';
                
                // í™•ëŒ€ ë°©ì§€
                document.body.style.overflow = 'hidden';
            }

            function draw(e) {
                if (!drawing) return;
                e.preventDefault();
                e.stopPropagation();
                const pos = getPos(e);
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#000';
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
            }

            function stopDraw(e) {
                if (e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                drawing = false;
                document.body.style.overflow = 'auto';
            }

            // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDraw);

            // í„°ì¹˜ ì´ë²¤íŠ¸
            canvas.addEventListener('touchstart', startDraw);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDraw);
        }

        // ì´ë²¤íŠ¸ ì„¤ì •
        function setupEvents() {
            // ì„œëª… íŒ¨ë“œ í´ë¦­
            const applicantPad = document.getElementById('applicantSignature');
            const managerPad = document.getElementById('managerSignature');

            if (applicantPad) {
                applicantPad.addEventListener('click', () => openSignatureModal('applicant'));
            }
            if (managerPad) {
                managerPad.addEventListener('click', () => openSignatureModal('manager'));
            }

            // ì„œëª… ëª¨ë‹¬ ë²„íŠ¼ë“¤
            const saveBtn = document.getElementById('saveSignature');
            const clearBtn = document.getElementById('clearLargeSignature');
            const cancelBtn = document.getElementById('cancelSignature');

            if (saveBtn) saveBtn.addEventListener('click', saveSignature);
            if (clearBtn) clearBtn.addEventListener('click', clearLargeSignature);
            if (cancelBtn) cancelBtn.addEventListener('click', closeSignatureModal);

            // ì„œëª… ì§€ìš°ê¸° ë²„íŠ¼ë“¤
            const clearApplicant = document.getElementById('clearApplicant');
            const clearManager = document.getElementById('clearManager');

            if (clearApplicant) {
                clearApplicant.addEventListener('click', () => clearSmallSignature('applicant'));
            }
            if (clearManager) {
                clearManager.addEventListener('click', () => clearSmallSignature('manager'));
            }

            // ê¸ˆì•¡ ì…ë ¥
            const amountInput = document.getElementById('amountInput');
            if (amountInput) {
                amountInput.addEventListener('click', () => {
                    const modal = document.getElementById('amountModal');
                    if (modal) {
                        modal.style.display = 'block';
                        const numberInput = document.getElementById('amountNumber');
                        if (numberInput) numberInput.focus();
                    }
                });
            }

            // ê¸ˆì•¡ í™•ì¸/ì·¨ì†Œ
            const confirmAmount = document.getElementById('confirmAmount');
            const cancelAmount = document.getElementById('cancelAmount');

            if (confirmAmount) {
                confirmAmount.addEventListener('click', () => {
                    const numberInput = document.getElementById('amountNumber');
                    const amountInput = document.getElementById('amountInput');
                    if (numberInput && amountInput && numberInput.value) {
                        const formatted = parseInt(numberInput.value).toLocaleString();
                        amountInput.value = formatted;
                    }
                    closeAmountModal();
                });
            }

            if (cancelAmount) {
                cancelAmount.addEventListener('click', closeAmountModal);
            }

            // ì—”í„°í‚¤
            const amountNumber = document.getElementById('amountNumber');
            if (amountNumber) {
                amountNumber.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const confirmBtn = document.getElementById('confirmAmount');
                        if (confirmBtn) confirmBtn.click();
                    }
                });
            }

            // ì €ì¥ ë²„íŠ¼ë“¤
            const saveJPG = document.getElementById('saveJPG');
            const savePDF = document.getElementById('savePDF');
            const printBtn = document.getElementById('printBtn');

            if (saveJPG) saveJPG.addEventListener('click', downloadJPG);
            if (savePDF) savePDF.addEventListener('click', downloadPDF);
            if (printBtn) printBtn.addEventListener('click', printForm);

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­
            window.addEventListener('click', (e) => {
                const amountModal = document.getElementById('amountModal');
                const signatureModal = document.getElementById('signatureModal');
                
                if (e.target === amountModal) closeAmountModal();
                if (e.target === signatureModal) closeSignatureModal();
            });
        }

        // ì„œëª… ëª¨ë‹¬ ì—´ê¸°
        function openSignatureModal(type) {
            currentSignatureType = type;
            const modal = document.getElementById('signatureModal');
            const title = document.getElementById('signatureTitle');

            if (title) {
                title.textContent = type === 'applicant' ? 'ì‹ ì²­ì ì„œëª…' : 'ë¶€ì„œì¥ ì„œëª…';
            }
            if (modal) {
                modal.style.display = 'block';
                // í™•ëŒ€ ë°©ì§€
                document.body.style.overflow = 'hidden';
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
                setupLargeCanvas();
            }
        }

        // ì„œëª… ëª¨ë‹¬ ë‹«ê¸°
        function closeSignatureModal() {
            const modal = document.getElementById('signatureModal');
            if (modal) modal.style.display = 'none';
            currentSignatureType = null;
            // í™•ëŒ€ ë°©ì§€ í•´ì œ
            document.body.style.overflow = 'auto';
            document.body.style.position = 'static';
            document.body.style.width = 'auto';
        }

        // ì„œëª… ì €ì¥
        function saveSignature() {
            if (!currentSignatureType || !canvases.large || !contexts.large) return;

            const targetCanvas = canvases[currentSignatureType];
            const targetCtx = contexts[currentSignatureType];
            
            if (!targetCanvas || !targetCtx) return;

            // ì‘ì€ ìº”ë²„ìŠ¤ì— ë³µì‚¬
            targetCtx.clearRect(0, 0, targetCanvas.width, targetCanvas.height);
            targetCtx.drawImage(canvases.large, 0, 0, canvases.large.width, canvases.large.height,
                               0, 0, targetCanvas.width, targetCanvas.height);

            // ìº”ë²„ìŠ¤ ë³´ì´ê¸°, placeholder ìˆ¨ê¸°ê¸°
            targetCanvas.style.display = 'block';
            const placeholder = document.getElementById(currentSignatureType + 'Placeholder');
            if (placeholder) placeholder.style.display = 'none';

            closeSignatureModal();
        }

        // í° ì„œëª… ì§€ìš°ê¸°
        function clearLargeSignature() {
            if (!canvases.large || !contexts.large) return;
            contexts.large.clearRect(0, 0, canvases.large.width, canvases.large.height);
            const placeholder = document.getElementById('largeSignaturePlaceholder');
            if (placeholder) placeholder.style.display = 'block';
        }

        // ì‘ì€ ì„œëª… ì§€ìš°ê¸°
        function clearSmallSignature(type) {
            const canvas = canvases[type];
            const ctx = contexts[type];
            
            if (!canvas || !ctx) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            canvas.style.display = 'none';
            
            const placeholder = document.getElementById(type + 'Placeholder');
            if (placeholder) placeholder.style.display = 'block';
        }

        // ê¸ˆì•¡ ëª¨ë‹¬ ë‹«ê¸°
        function closeAmountModal() {
            const modal = document.getElementById('amountModal');
            if (modal) modal.style.display = 'none';
        }

        // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
        function setToday() {
            const today = new Date().toISOString().slice(0, 10);
            const dateInput = document.getElementById('applicationDate');
            if (dateInput) dateInput.value = today;
        }

        // ë²„íŠ¼ ìˆ¨ê¸°ê¸°/ë³´ì´ê¸°
        function hideButtons() {
            const elements = document.querySelectorAll('.clear-btn, .save-options');
            elements.forEach(el => el.style.display = 'none');
        }

        function showButtons() {
            const clearBtns = document.querySelectorAll('.clear-btn');
            const saveOptions = document.querySelector('.save-options');
            
            clearBtns.forEach(btn => btn.style.display = 'inline-block');
            if (saveOptions) saveOptions.style.display = 'block';
        }

        // JPG ë‹¤ìš´ë¡œë“œ (í™”ë©´ê³¼ ë™ì¼í•œ ë ˆì´ì•„ì›ƒ)
        function downloadJPG() {
            hideButtons();
            
            try {
                // ì‹¤ì œ í¼ ì»¨í…Œì´ë„ˆë¥¼ ìº”ë²„ìŠ¤ë¡œ ë³€í™˜
                const formContainer = document.getElementById('formContainer');
                const rect = formContainer.getBoundingClientRect();
                
                // 10cm í­ ê¸°ì¤€ìœ¼ë¡œ ìŠ¤ì¼€ì¼ ê³„ì‚° (378px = 10cm at 96DPI)
                const targetWidth = 378;
                const scale = targetWidth / rect.width;
                const targetHeight = rect.height * scale;
                
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                
                // ë°°ê²½ìƒ‰
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // í¼ ì»¨í…Œì´ë„ˆ ë°°ê²½
                const containerPadding = 25 * scale;
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(containerPadding, containerPadding, canvas.width - (containerPadding * 2), canvas.height - (containerPadding * 2));
                
                // ê·¸ë¦¼ì íš¨ê³¼
                ctx.shadowColor = 'rgba(0,0,0,0.1)';
                ctx.shadowBlur = 10 * scale;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 2 * scale;
                ctx.fillRect(containerPadding, containerPadding, canvas.width - (containerPadding * 2), canvas.height - (containerPadding * 2));
                ctx.shadowColor = 'transparent';
                
                // í—¤ë” ì˜ì—­
                const headerY = containerPadding + (25 * scale);
                ctx.fillStyle = '#2c3e50';
                ctx.fillRect(containerPadding, headerY, canvas.width - (containerPadding * 2), 2 * scale);
                
                // ì œëª©
                ctx.fillStyle = '#2c3e50';
                ctx.font = `bold ${22 * scale}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText('ì˜ìˆ˜ì¦ ë©´ì œ ì‹ ì²­ì„œ', canvas.width / 2, headerY - (5 * scale));
                
                // ì…ë ¥ í•„ë“œë“¤
                let y = headerY + (30 * scale);
                const leftMargin = containerPadding + (20 * scale);
                const labelWidth = 100 * scale;
                const fontSize = 14 * scale;
                
                ctx.font = `bold ${fontSize}px Arial`;
                ctx.textAlign = 'left';
                ctx.fillStyle = '#34495e';
                
                // ì‹ ì²­ì¼
                ctx.fillText('ì‹ ì²­ì¼:', leftMargin, y);
                ctx.fillStyle = '#3498db';
                ctx.font = `${fontSize}px Arial`;
                const applicationDate = document.getElementById('applicationDate').value;
                if (applicationDate) {
                    const formattedDate = new Date(applicationDate).toLocaleDateString('ko-KR');
                    ctx.fillText(formattedDate, leftMargin + labelWidth, y);
                }
                
                // í•˜ë‹¨ ì„  ê·¸ë¦¬ê¸°
                ctx.strokeStyle = '#bdc3c7';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(leftMargin + labelWidth, y + (5 * scale));
                ctx.lineTo(canvas.width - (containerPadding + 20 * scale), y + (5 * scale));
                ctx.stroke();
                
                y += 35 * scale;
                
                // ì§€ì¶œì¼ì
                ctx.fillStyle = '#34495e';
                ctx.font = `bold ${fontSize}px Arial`;
                ctx.fillText('ì§€ì¶œì¼ì:', leftMargin, y);
                ctx.fillStyle = '#3498db';
                ctx.font = `${fontSize}px Arial`;
                const expenseDate = document.getElementById('expenseDate').value;
                if (expenseDate) {
                    const formattedExpenseDate = new Date(expenseDate).toLocaleDateString('ko-KR');
                    ctx.fillText(formattedExpenseDate, leftMargin + labelWidth, y);
                }
                
                // í•˜ë‹¨ ì„ 
                ctx.beginPath();
                ctx.moveTo(leftMargin + labelWidth, y + (5 * scale));
                ctx.lineTo(canvas.width - (containerPadding + 20 * scale), y + (5 * scale));
                ctx.stroke();
                
                y += 35 * scale;
                
                // ì§€ì¶œê¸ˆì•¡
                ctx.fillStyle = '#34495e';
                ctx.font = `bold ${fontSize}px Arial`;
                ctx.fillText('ì§€ì¶œê¸ˆì•¡:', leftMargin, y);
                ctx.fillStyle = '#000000';
                ctx.font = `${fontSize}px Arial`;
                ctx.textAlign = 'right';
                const amount = document.getElementById('amountInput').value;
                ctx.fillText(amount, canvas.width - (containerPadding + 50 * scale), y);
                ctx.textAlign = 'left';
                ctx.fillText('ì›', canvas.width - (containerPadding + 40 * scale), y);
                
                // í•˜ë‹¨ ì„ 
                ctx.beginPath();
                ctx.moveTo(leftMargin + labelWidth, y + (5 * scale));
                ctx.lineTo(canvas.width - (containerPadding + 20 * scale), y + (5 * scale));
                ctx.stroke();
                
                y += 35 * scale;
                
                // ì§€ì¶œë‚´ìš©
                ctx.fillStyle = '#34495e';
                ctx.font = `bold ${fontSize}px Arial`;
                ctx.textAlign = 'left';
                ctx.fillText('ì§€ì¶œë‚´ìš©:', leftMargin, y);
                ctx.fillStyle = '#000000';
                ctx.font = `${fontSize}px Arial`;
                const content = document.getElementById('expenseContent').value;
                ctx.fillText(content, leftMargin + labelWidth, y);
                
                // í•˜ë‹¨ ì„ 
                ctx.beginPath();
                ctx.moveTo(leftMargin + labelWidth, y + (5 * scale));
                ctx.lineTo(canvas.width - (containerPadding + 20 * scale), y + (5 * scale));
                ctx.stroke();
                
                y += 35 * scale;
                
                // ìƒì„¸ì‚¬ìœ 
                ctx.fillStyle = '#34495e';
                ctx.font = `bold ${fontSize}px Arial`;
                ctx.fillText('ìƒì„¸ì‚¬ìœ :', leftMargin, y);
                
                y += 20 * scale;
                
                // ìƒì„¸ì‚¬ìœ  ë°•ìŠ¤
                const reasonBoxX = leftMargin;
                const reasonBoxY = y;
                const reasonBoxWidth = canvas.width - (containerPadding + 40 * scale);
                const reasonBoxHeight = 60 * scale;
                
                ctx.strokeStyle = '#bdc3c7';
                ctx.lineWidth = 1;
                ctx.strokeRect(reasonBoxX, reasonBoxY, reasonBoxWidth, reasonBoxHeight);
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(reasonBoxX, reasonBoxY, reasonBoxWidth, reasonBoxHeight);
                
                // ìƒì„¸ì‚¬ìœ  í…ìŠ¤íŠ¸
                ctx.fillStyle = '#000000';
                ctx.font = `${fontSize}px Arial`;
                const detailReason = document.getElementById('detailReason').value;
                ctx.fillText(detailReason, reasonBoxX + (10 * scale), reasonBoxY + (20 * scale));
                
                y += reasonBoxHeight + (30 * scale);
                
                // ì˜ìˆ˜ì¦ ë¯¸ì²¨ë¶€ ì‚¬ìœ 
                ctx.fillStyle = '#34495e';
                ctx.font = `bold ${fontSize}px Arial`;
                ctx.fillText('ì˜ìˆ˜ì¦ ë¯¸ì²¨ë¶€ ì‚¬ìœ ', leftMargin, y);
                
                y += 25 * scale;
                
                // ì²´í¬ë°•ìŠ¤ë“¤
                const checkboxes = [
                    { id: 'reason1', text: 'ì˜ìˆ˜ì¦ ë¶„ì‹¤' },
                    { id: 'reason2', text: 'ì˜ìˆ˜ì¦ ë¯¸ë°œí–‰' },
                    { id: 'reason3', text: 'ê²½ì¡°ì‚¬ë¹„' },
                    { id: 'reason4', text: 'êµí†µë¹„' },
                    { id: 'reason5', text: 'ê¸°íƒ€' }
                ];
                
                let checkboxX = leftMargin;
                let checkboxY = y;
                
                checkboxes.forEach((checkbox, index) => {
                    const checked = document.getElementById(checkbox.id).checked;
                    ctx.fillStyle = '#000000';
                    ctx.font = `${fontSize}px Arial`;
                    
                    // ì²´í¬ë°•ìŠ¤
                    ctx.strokeStyle = '#bdc3c7';
                    ctx.strokeRect(checkboxX, checkboxY - (12 * scale), 12 * scale, 12 * scale);
                    
                    if (checked) {
                        ctx.fillStyle = '#3498db';
                        ctx.fillRect(checkboxX + (2 * scale), checkboxY - (10 * scale), 8 * scale, 8 * scale);
                    }
                    
                    // í…ìŠ¤íŠ¸
                    ctx.fillStyle = '#000000';
                    ctx.fillText(checkbox.text, checkboxX + (20 * scale), checkboxY);
                    
                    checkboxX += (ctx.measureText(checkbox.text).width + 40 * scale);
                    
                    // 3ë²ˆì§¸ í›„ ì¤„ë°”ê¿ˆ
                    if (index === 2) {
                        checkboxX = leftMargin;
                        checkboxY += 25 * scale;
                    }
                });
                
                y = checkboxY + (40 * scale);
                
                // ì„œëª… ì˜ì—­
                const signatureBoxWidth = (canvas.width - (containerPadding + 60 * scale)) / 2;
                const signatureBoxHeight = 80 * scale;
                
                // ì‹ ì²­ì ì„œëª…
                ctx.strokeStyle = '#bdc3c7';
                ctx.strokeRect(leftMargin, y, signatureBoxWidth, signatureBoxHeight);
                
                // ì‹ ì²­ì ì„œëª… ì´ë¯¸ì§€
                const applicantCanvas = canvases.applicant;
                if (applicantCanvas && applicantCanvas.style.display !== 'none') {
                    ctx.drawImage(applicantCanvas, leftMargin + (5 * scale), y + (5 * scale), 
                                signatureBoxWidth - (10 * scale), signatureBoxHeight - (10 * scale));
                } else {
                    ctx.fillStyle = '#bdc3c7';
                    ctx.font = `${12 * scale}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.fillText('ì„œëª…í•˜ë ¤ë©´ í´ë¦­', leftMargin + signatureBoxWidth/2, y + signatureBoxHeight/2);
                }
                
                ctx.fillStyle = '#000000';
                ctx.font = `bold ${12 * scale}px Arial`;
                ctx.fillText('ì‹ ì²­ì', leftMargin + signatureBoxWidth/2, y + signatureBoxHeight + (15 * scale));
                
                // ë¶€ì„œì¥ ì„œëª…
                const secondBoxX = leftMargin + signatureBoxWidth + (20 * scale);
                ctx.strokeRect(secondBoxX, y, signatureBoxWidth, signatureBoxHeight);
                
                // ë¶€ì„œì¥ ì„œëª… ì´ë¯¸ì§€
                const managerCanvas = canvases.manager;
                if (managerCanvas && managerCanvas.style.display !== 'none') {
                    ctx.drawImage(managerCanvas, secondBoxX + (5 * scale), y + (5 * scale), 
                                signatureBoxWidth - (10 * scale), signatureBoxHeight - (10 * scale));
                } else {
                    ctx.fillStyle = '#bdc3c7';
                    ctx.font = `${12 * scale}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.fillText('ì„œëª…í•˜ë ¤ë©´ í´ë¦­', secondBoxX + signatureBoxWidth/2, y + signatureBoxHeight/2);
                }
                
                ctx.fillStyle = '#000000';
                ctx.font = `bold ${12 * scale}px Arial`;
                ctx.fillText('ë¶€ì„œì¥ ìŠ¹ì¸', secondBoxX + signatureBoxWidth/2, y + signatureBoxHeight + (15 * scale));
                
                // ë‹¤ìš´ë¡œë“œ
                const link = document.createElement('a');
                link.download = `ì˜ìˆ˜ì¦ë©´ì œì‹ ì²­ì„œ_${new Date().toISOString().slice(0, 10).replace(/-/g, '')}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('âœ… í™”ë©´ê³¼ ë™ì¼í•œ JPG íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! (10cm í­)');
            } catch (error) {
                console.error('JPG ì €ì¥ ì˜¤ë¥˜:', error);
                alert('âŒ JPG ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
            showButtons();
        }

        // PDF ë‹¤ìš´ë¡œë“œ
        function downloadPDF() {
            hideButtons();
            setTimeout(() => {
                window.print();
                showButtons();
                alert('ğŸ’¡ ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ "PDFë¡œ ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”!');
            }, 100);
        }

        // ì¸ì‡„
        function printForm() {
            hideButtons();
            window.print();
            setTimeout(showButtons, 1000);
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
